# DPFunc
 Accurately predicting protein function via deep learning with domain-guided structure information

## Usage
Here we provide instructions for two use cases: (1) Testing our trained model on your data. (2) Retraining our model on your data.

Note: This README is still in progress and we are trying to complete it within the next two weeks. If you encounter any bugs or issues, feel free to contact us.

## Test our model on your data

### Model preparation
You can download our models from `./data/download_link.txt` and get our trained model.

### Prediction
You should prepare your configure file as requirement (see `./configure/mf.yaml` as an example), following items must be clarified:
```
name: mf   # The ontology you want to choose: mf/bp/cc. Make sure it matches the file name of configuration file (mf.yaml/bp.yaml/cc.yaml).
model_path: models  # The directory to store the model, default is the './models/' folder. 
mlb: ./mlb/mf_go.mlb    # Ensure that the corresponding file exists; this file contains the GO terms encountered during our model training process.
results: ./results  # The directory to save results.

base:
  interpro_whole: ./data/PDB/pdb_interpro_whole_protein/{}.pkl  # The interpro file of your test proteins.
  residue_feature: # The residue-level esm features of your test proteins. The details can be found in later sections.
  pdb_points: # The coordinate file of proteins, generated by `./DataProcess/generate_points.py`. The details can be found in later sections.

test:
  name: test
  pid_list_file: ./data/mf_test2_used_pid_list.pkl  # The test protein list ('.pkl' format).
  pid_go_file: ./data/test_mf_go.txt   # The test proteins GO (for evaluation if provided).
  pid_pdb_file: ./data/mf_test_whole_pdb_part0.pkl   # The structure graphs of test proteins.
  interpro_file: ./data/mf_test_interpro.pkl # The interpro items of test proteins.
```
Notably, to generate `pid_pdb_file` and `interpro_file`, you need complete the following steps:
1. For `pid_pdb_file`:

    1.1 You should place your PDB files of proteins (5NTC_RAT.pdb, 6PGL_SCHPO.pdb, ...) at `./data/PDB/PDB_folder/`.

    1.2 Use `generate_points.py` to generate the coordinate files of proteins, the result file will be placed at `./data/pdb_points.pkl`.
    ```
    python ./DataProcess/generate_points.py -i ./data/mf_test2_used_pid_list.pkl -o pdb_points
    ```
    
    1.3 Use pre-trained language model (`esm` or other PLLMs) to generate the residue features. As the number of proteins may be too large, we suggest that users should partition the whole data into several parts and an additional map file `map_pid_esm_file` (`dict` format) is also needed to map the part id of each proteins. The example map file can be obtained from the `./data/map_pid_esm_file.pkl` and example data can be obtained from `./data/PDB/part_result_esm_residue_level/result_part/pdb_residue_esm_embeddings_part{part_id}.pkl`.
    
    1.4 Based on `pdb_points.pkl`, `map_pid_esm_file.pkl`, and `pdb_residue_esm_embeddings_part{part_id}.pkl`, using `process_graph.py` to generate the structure graphs for test data. (Note: change the paths in the file)
    ```
    python ./DataProcess/process_graph.py -d mf
    ```
    The result file will be placed at `./data/PDB/graph_feature/mf_test_whole_pdb_part{part_id}.pkl`

2. For `interpro_file`:
    
    2.1 Use InterProScan tool to generate the interpro items (an example can be obtained from `./data/PDB/pdb_interpro_whole_protein/{}.pkl`). Then, using `process_interpro.py` to generate the interpro sparse matrix. (Note: use your own paths in the file)
    ```
    python ./DataProcess/process_interpro.py
    ```


## Train our model on your own data
If you have prepared the data, you can train our model on your data as follows (Ensure that your configure file is right):
```
python DPFunc_main.py -d mf -n 0 -e 15 -p temp_model

arguments:
    -d: the ontology (mf/cc/bp)
    -n: gpu number (default: 0)
    -e: training epoch (default: 15)
    -p: the prefix of results (default: temp_model)
```

## Contact
Please feel free to contact us for any further questions.
- Wenkang Wang wangwk@csu.edu.cn
- Min Li limin@mail.csu.edu.cn

## References
Wang W, Shuai Y, Zeng M, et al. DPFunc: accurately predicting protein function via deep learning with domain-guided structure information[J]. Nature Communications, 2025, 16(1): 70.

